var bedSocket,wm_cols=[1,2,3,4,5,6,7,8,9,10],wm_layoutColumns=0,wm_single_bedid=null,wm_trend_interval=null,wm_trend_range=4,wm_rooms={},wm_localClockDiffToServer=0,wm_domRooms=null,selected_groups=new Set,txtTime="",fastForward=0,months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],queryString=location.search.replace(/^.*?\=/,"");0==queryString.indexOf("guide")&&(document.querySelector("footer").style.display="none");var vver_latest=null;const STANDARD_SAMPLE_RATE=100,MAX_NETWORK_LATENCY=2;var img_top_patient=document.getElementById("img-top-patient"),img_offline=document.getElementById("img-offline"),img_vitaldb_logo=document.getElementById("img-vitaldb-logo"),wm_groups=[{fgColor:"#00FF00",wav:"ECG_WAV",paramLayout:"TWO",param:["ECG_HR","ECG_ST"],name:"ECG"},{fgColor:"#FF0000",wav:"IABP_WAV",paramLayout:"BP",param:["IABP_SBP","IABP_DBP","IABP_MBP"],name:"ART"},{fgColor:"#82CEFC",wav:"PLETH_WAV",paramLayout:"TWO",param:["PLETH_SPO2","PLETH_HR"],name:"PLETH"},{fgColor:"#FAA804",wav:"CVP_WAV",paramLayout:"ONE",param:["CVP_CVP"],name:"CVP"},{fgColor:"#FAA804",wav:"RESP_WAV",paramLayout:"ONE",param:["RESP_RR"],name:"RESP"},{fgColor:"#DAA2DC",wav:"EEG_WAV",paramLayout:"TWO",param:["EEG_BIS","EEG_SEF"],name:"EEG"},{fgColor:"#DAA2DC",wav:"EEGR_WAV",paramLayout:"ONE",param:["EEG_SEFR"],name:"EEGR"},{fgColor:"#FAA804",paramLayout:"TWO",param:["AGENT_CONC","AGENT_NAME"],name:"AGENT"},{fgColor:"#FAA804",paramLayout:"TWO",param:["AGENT1_CONC","AGENT1_NAME"],name:"AGENT1"},{fgColor:"#FAA804",paramLayout:"TWO",param:["AGENT2_CONC","AGENT2_NAME"],name:"AGENT2"},{fgColor:"#FAA804",paramLayout:"TWO",param:["AGENT3_CONC","AGENT3_NAME"],name:"AGENT3"},{fgColor:"#FAA804",paramLayout:"TWO",param:["AGENT4_CONC","AGENT4_NAME"],name:"AGENT4"},{fgColor:"#FAA804",paramLayout:"TWO",param:["AGENT5_CONC","AGENT5_NAME"],name:"AGENT5"},{fgColor:"#9ACE34",paramLayout:"TWO",param:["DRUG_CE","DRUG_NAME"],name:"DRUG"},{fgColor:"#9ACE34",paramLayout:"TWO",param:["DRUG1_CE","DRUG1_NAME"],name:"DRUG1"},{fgColor:"#9ACE34",paramLayout:"TWO",param:["DRUG2_CE","DRUG2_NAME"],name:"DRUG2"},{fgColor:"#9ACE34",paramLayout:"TWO",param:["DRUG3_CE","DRUG3_NAME"],name:"DRUG3"},{fgColor:"#9ACE34",paramLayout:"TWO",param:["DRUG4_CE","DRUG4_NAME"],name:"DRUG4"},{fgColor:"#9ACE34",paramLayout:"TWO",param:["DRUG5_CE","DRUG5_NAME"],name:"DRUG5"},{fgColor:"#FFFF00",wav:"CO2_WAV",paramLayout:"TWO",param:["CO2_CONC","CO2_RR"],name:"CO2"},{fgColor:"#FFFFFF",wav:"AWP_WAV",paramLayout:"VNT",name:"VNT",param:["TV","RESP_RR","PIP","PEEP"]},{fgColor:"#F08080",paramLayout:"VNT",name:"NMT",param:["TOF_RATIO","TOF_CNT","PTC_CNT"]},{fgColor:"#FFFFFF",paramLayout:"BP",param:["NIBP_SBP","NIBP_DBP","NIBP_MBP"],name:"NIBP"},{fgColor:"#DAA2DC",wav:"EEGL_WAV",paramLayout:"TWO",param:["PSI","EEG_SEFL","EEG_SEFR"],name:"MASIMO"},{fgColor:"#FF0000",paramLayout:"TWO",param:["SPHB","PVI"]},{fgColor:"#FFC0CB",paramLayout:"TWO",param:["CO","SVV"],name:"CARTIC"},{fgColor:"#FFFFFF",paramLayout:"LR",param:["STO2_L","STO2_R"],name:"STO2"},{fgColor:"#828284",paramLayout:"TWO",param:["FLUID_RATE","FLUID_TOTAL"],name:"FLUID"},{fgColor:"#D2B48C",paramLayout:"ONE",param:["BT"]},{fgColor:"#FFC0CB",paramLayout:"ONE",param:["HPI"]},{fgColor:"#FF0000",wav:"PAP_WAV",paramLayout:"BP",param:["PAP_SBP","PAP_DBP","PAP_MBP"],name:"PAP"},{fgColor:"#FF0000",wav:"FEM_WAV",paramLayout:"BP",param:["FEM_SBP","FEM_DBP","FEM_MBP"],name:"FEM"},{fgColor:"#00FF00",wav:"SKNA_WAV",paramLayout:"ONE",param:["ASKNA"],name:"SKNA"},{fgColor:"#FFFFFF",wav:"ICP_WAV",paramLayout:"TWO",param:["ICP","CPP"]},{fgColor:"#FF7F51",paramLayout:"TWO",param:["ANIM","ANII"]},{fgColor:"#99d9ea",paramLayout:"TWO",param:["FILT1_1","FILT1_2"]},{fgColor:"#C8BFE7",paramLayout:"TWO",param:["FILT2_1","FILT2_2"]},{fgColor:"#EFE4B0",paramLayout:"TWO",param:["FILT3_1","FILT3_2"]},{fgColor:"#FFAEC9",paramLayout:"TWO",param:["FILT4_1","FILT4_2"]},{fgColor:"#99d9ea",paramLayout:"TWO",param:["FILT5_1","FILT5_2"]},{fgColor:"#C8BFE7",paramLayout:"TWO",param:["FILT6_1","FILT6_2"]},{fgColor:"#EFE4B0",paramLayout:"TWO",param:["FILT7_1","FILT7_2"]},{fgColor:"#FFAEC9",paramLayout:"TWO",param:["FILT8_1","FILT8_2"]},{fgColor:"#99d9ea",paramLayout:"TWO",param:["FILT9_1","FILT9_2"]},{fgColor:"#C8BFE7",paramLayout:"TWO",param:["FILT10_1","FILT10_2"]},{fgColor:"#EFE4B0",paramLayout:"TWO",param:["FILT11_1","FILT11_2"]},{fgColor:"#FFAEC9",paramLayout:"TWO",param:["FILT12_1","FILT12_2"]},{fgColor:"#FFAEC9",paramLayout:"ONE",param:["BAT"]},{fgColor:"#FFAEC9",paramLayout:"ONE",param:["SET_CMV_FX"]}],montype_groupids={};const PAR_WIDTH=160,PAR_HEIGHT=80;var wm_paramLayouts={ONE:[{name:{baseline:"top",x:5,y:10},value:{fontsize:38,align:"right",x:PAR_WIDTH-5,y:PAR_HEIGHT-15}}],TWO:[{name:{baseline:"top",x:5,y:10},value:{fontsize:38,align:"right",x:PAR_WIDTH-5,y:42}},{name:{baseline:"bottom",x:5,y:PAR_HEIGHT-9},value:{fontsize:24,align:"right",x:PAR_WIDTH-5,y:PAR_HEIGHT-12}}],LR:[{name:{baseline:"top",x:5,y:10},value:{fontsize:38,align:"left",x:5,y:PAR_HEIGHT-10}},{name:{align:"right",baseline:"top",x:PAR_WIDTH-3,y:9},value:{fontsize:38,align:"right",x:PAR_WIDTH-5,y:PAR_HEIGHT-15}}],BP:[{name:{baseline:"top",x:5,y:10},value:{fontsize:36,align:"right",x:PAR_WIDTH-5,y:39}},{value:{fontsize:36,align:"right",x:PAR_WIDTH-5,y:PAR_HEIGHT-10}}],VNT:[{name:{baseline:"top",x:5,y:10},value:{fontsize:36,align:"right",x:PAR_WIDTH-45,y:42}},{value:{fontsize:28,align:"right",x:PAR_WIDTH-5,y:42}},{value:{fontsize:22,align:"right",x:PAR_WIDTH-5,y:PAR_HEIGHT-13}}]},wm_trend={vital:{ART_SBP:{name:"ART",color:"#FF0000",type:"bar"},ART_DBP:{color:"#FF0000",type:"bar"},NIBP_SBP:{name:"NIBP",color:"rgba(255, 255, 255, .5)",type:"bar"},NIBP_DBP:{color:"rgba(255, 255, 255, .5)",type:"bar"},HR:{name:"HR",color:"#00FF00",type:"line"},PLETH_SPO2:{name:"SpO2",color:"#82CEFC",type:"line"},BT:{name:"Temp",color:"#D2B48C",type:"line"},BIS:{name:"iEEG",color:"#DAA2DC",type:"line"},PSI:{color:"#DAA2DC",type:"line"}},ane:{DESF:{name:"DES",color:"#2296E6",type:"bar"},SEVO:{name:"SEVO",color:"#FFA500",type:"bar"},PROP:{name:"PPF",color:"#FFFFFF",type:"bar"},REMI:{name:"RFTN",color:"rgba(154, 206, 52, .5)",type:"bar"}},filt:{"filters.abp_hpi":{name:"HPI",color:"#00FFFF",type:"bar"},ART_MBP:{name:"MAP",color:"#FF0000",type:"line"}}},isMobile={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)||navigator.userAgent.match(/WPDesktop/i)},any:function(){return isMobile.Android()||isMobile.BlackBerry()||isMobile.iOS()||isMobile.Opera()||isMobile.Windows()}},wm_isMobile=isMobile.any();function isIE(){var e=navigator.userAgent.toLowerCase();return"Netscape"==navigator.appName&&-1!=e.indexOf("trident")||-1!=e.indexOf("msie")}var VIEW_HEIGHT=Math.max(document.documentElement.clientHeight,window.innerHeight);function show_log(e){for(var t in wm_rooms)t!=e&&delete wm_rooms[t].show_log;var i=wm_rooms[e];i.show_log=!0,i.is_first_show=!0,document.addEventListener("keydown",function(e){32==e.keyCode&&(e.preventDefault(),delete i.show_log)})}function render_vr_setting(e){e=wm_rooms[e].vr_ipaddr;e?window.open("http://"+e,"_blank").focus():alert("Not Connected")}function check_visible(e){if(!$(e).parent().is(":visible"))return!1;e=e.getBoundingClientRect();return!(e.bottom<0||e.top>=VIEW_HEIGHT)}function wm_serverNow(){return Date.now()/1e3-wm_localClockDiffToServer}function currentTime(){var e=document.getElementById("rt-clock"),t=new Date,i=t.getFullYear(),a=t.getDate(),o=t.getMonth(),n=t.getHours(),s=t.getMinutes(),r=t.getSeconds(),s=checkTime(s),r=checkTime(r);e&&(t=Math.sqrt(window.innerWidth)/2,e.innerHTML="<font style='font-size:"+parseInt(t)+"px'>"+a+" "+months[o]+" "+i+"</font> <font style='font-size:"+parseInt(1.3*t)+"px'>"+n+":"+s+":"+r+"</font>")}function checkTime(e){return e=e<10?"0"+e:e}function toggleFullScreen(){var e=document,t=e.documentElement,i=t.requestFullscreen||t.mozRequestFullScreen||t.webkitRequestFullScreen||t.msRequestFullscreen,a=e.exitFullscreen||e.mozCancelFullScreen||e.webkitExitFullscreen||e.msExitFullscreen;e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement?a.call(e):i.call(t)}function wm_expandWindow(){var e=document.getElementById("wm-expand").getElementsByTagName("i")[0],t=document.getElementById("wm-ptlabel"),i=document.getElementById("wm-offline"),a=document.getElementsByClassName("sel-col")[0],o=document.getElementById("sel-user"),n=document.getElementById("content"),s=document.getElementsByClassName("navbar")[0],r=document.getElementsByTagName("header")[0],l=n.getElementsByClassName("bd-callout")[0],n=document.getElementById("room-status");e.classList.contains("fa-expand-alt")?(document.documentElement.webkitRequestFullscreen(),$("#content").css("padding-top","15px"),$(".sidetab").css({"background-color":"#262626",color:"white"}),$(".sidetab .closebtn").css("color","white"),$(".sidetab th").css({"background-color":"#262626",color:"white"}),$(".bed").addClass("dark"),$(".Unnamed").addClass("dark"),document.body.style.backgroundColor="black",n.style.color="white",document.getElementById("rt-clock").style.color="white",$("#group-filter-btn").removeClass("btn-light").addClass("btn-gray"),$("#toolbar").css({"background-color":"black",top:0}),t.classList.remove("btn-primary"),t.classList.remove("btn-light"),Cookies.get("WebMonitoring_patientOn")?t.classList.add("btn-light2"):t.classList.add("btn-gray"),i.classList.remove("btn-primary"),i.classList.remove("btn-light"),Cookies.get("WebMonitoring_offline")?(i.classList.add("btn-light2"),$("#wifi-img").prop("src","/static/img/wifi-off.png")):Cookies.get("WebMonitoring_online")?(i.classList.add("btn-light2"),$("#wifi-img").prop("src","/static/img/wifi.png")):($("#wifi-img").prop("src","/static/img/wifi-white.png"),i.classList.add("btn-gray")),e.classList.remove("fa-expand-alt"),e.classList.add("fa-compress-alt"),e.parentNode.classList.remove("btn-light"),e.parentNode.classList.add("btn-gray"),$("#wm-refresh").toggleClass("btn-light btn-gray"),$("#add-vr-btn").toggleClass("btn-light btn-gray"),$("#edit-group-btn").hide(),$("#btn-sel-all").hide(),$("#btn-user-list").hide(),$("#show-inactive-btn").hide(),a.classList.add("sel-dark"),null!==o&&o.classList.add("sel-dark"),s.classList.add("d-none"),r.classList.add("d-none"),l&&l.classList.add("d-none"),wm_changeLayoutColumns(wm_layoutColumns),Cookies.set("WebMonitoring_expanded","1")):(window.innerHeight==screen.height&&document.exitFullscreen(),$("#wm-rooms").css("max-height",""),$("#wm-rooms").css("overflow-y",""),$("#wm-rooms").css("overflow-x",""),$("#content").css("padding-top","100px"),$(".sidetab").css({"background-color":"",color:""}),$(".sidetab .closebtn").css("color",""),$(".sidetab th").css({"background-color":"",color:""}),$(".bed").removeClass("dark"),$(".Unnamed").removeClass("dark"),document.body.style.backgroundColor="white",n.style.color="black",document.getElementById("rt-clock").style.color="black",$("#group-filter-btn").removeClass("btn-dark").addClass("btn-light"),$("#toolbar").css({"background-color":"white",top:"92px"}),t.classList.remove("btn-light2"),t.classList.remove("btn-gray"),Cookies.get("WebMonitoring_patientOn")?t.classList.add("btn-primary"):t.classList.add("btn-light"),i.classList.remove("btn-light2"),i.classList.remove("btn-gray"),Cookies.get("WebMonitoring_offline")?(i.classList.add("btn-primary"),$("#wifi-img").prop("src","/static/img/wifi-off-white.png")):Cookies.get("WebMonitoring_online")?(i.classList.add("btn-primary"),$("#wifi-img").prop("src","/static/img/wifi-white.png")):($("#wifi-img").prop("src","/static/img/wifi.png"),i.classList.add("btn-light")),e.classList.remove("fa-compress-alt"),e.classList.add("fa-expand-alt"),e.parentNode.classList.remove("btn-gray"),e.parentNode.classList.add("btn-light"),$("#wm-refresh").toggleClass("btn-gray btn-light"),$("#add-vr-btn").toggleClass("btn-gray btn-light"),$("#edit-group-btn").show(),$("#btn-sel-all").show(),$("#btn-user-list").show(),$("#show-inactive-btn").show(),a.classList.remove("sel-dark"),null!==o&&o.classList.remove("sel-dark"),s.classList.remove("d-none"),r.classList.remove("d-none"),l&&l.classList.remove("d-none"),Cookies.remove("WebMonitoring_expanded")),wm_onResizeWindow()}function wm_resizeRoomHeight(){var i=$(".wm-room"),a=0,o=0,n=240;i.each(function(e){if("none"!=$(this).css("display")&&(o++,room_height=$(this).find("canvas").height(),room_height>n&&(n=room_height)),0<o&&o%wm_layoutColumns==0||e==i.length-1){for(var t=a;t<=e;t++)$(i[t]).css("max-height",n+22);a=e+1,o=0,n=240}})}function wm_resizeRoomWidth(){for(var e in wm_updateLayoutButtons(wm_cols.indexOf(parseInt(wm_layoutColumns))),wm_domRooms=wm_domRooms||document.getElementsByClassName("wm-rooms")[0],wm_rooms){var t=wm_rooms[e];e==wm_single_bedid?(t.domRoot.style.width=document.documentElement.clientWidth+"px",$(t.domCanvas).css("width",window.innerWidth-20),$(t.domCanvas).css("height",window.innerHeight-20),t.domCanvas.width=window.innerWidth-20,t.domCanvas.height=window.innerHeight-20,t.domControl.style.width=Math.floor((window.innerWidth-20)/2-9)+"px"):(t.domRoot.style.width=parseInt(wm_domRooms.clientWidth/wm_layoutColumns)+"px",t.domControl.style.display="none",t.domCanvas.style.width="100%",t.domCanvas.style.height="")}}function wm_changeLayoutColumns(e,t){wm_layoutColumns=e,wm_resizeRoomWidth(),wm_resizeRoomHeight(),t&&Cookies.set("WebMonitoring_layoutColumns",e.toString())}function show_edit(e){$("#"+$.escapeSelector(e)).show()}function hide_edit(e){$("#"+$.escapeSelector(e)).hide()}function wm_selAllGroup(){var e=$("#sel-all-group").prop("checked");e?(selected_groups=new Set,$("#group-filter-side-tab").find("input[type='checkbox']").each(function(){"sel-all-group"!=$(this).prop("id")&&($(this).prop("checked",e),selected_groups.add(this.id))})):$("#group-filter-side-tab").find("input[type='checkbox']").each(function(){$(this).prop("checked",e),selected_groups.delete(this.id)}),wm_changeCurrentFilter()}function wm_selGroup(e){$(e).prop("checked")?selected_groups.add(e.id):(selected_groups.delete(e.id),$("#sel-all-group").prop("checked",!1)),wm_changeCurrentFilter()}function wm_changeCurrentFilter(){if(selected_groups.size<=0){for(var e in wm_rooms)(t=wm_rooms[e]).domRoot.style.display="inline-block";$("#edit-group-btn").addClass("disabled")}else for(var e in wm_rooms){var t=wm_rooms[e];selected_groups.has(t.groupname)?t.domRoot.style.display="inline-block":t.domRoot.style.display="none"}wm_changeLayoutColumns(wm_layoutColumns),Cookies.set("WebMonitoring_currentFilter",[...selected_groups].join()),update_room_visibility()}function wm_onResizeWindow(){wm_changeLayoutColumns(wm_layoutColumns)}function wm_updateLayoutButtons(e){document.getElementsByClassName("wm-layout")[0].getElementsByClassName("sel-col")[0].selectedIndex=e}function wm_initLayoutButtons(){var e=document.getElementsByClassName("wm-layout")[0].getElementsByClassName("sel-col")[0];e.addEventListener("change",function(){wm_changeLayoutColumns(e.options[e.selectedIndex].value,!0,!0)})}function wm_updateFilterButtons(e){document.getElementsByClassName("wm-filter")[0].getElementsByClassName("sel-group")[0].selectedIndex=e}function wm_initFilterButtons(){var e=document.getElementsByClassName("wm-filter")[0].getElementsByClassName("sel-group")[0];e.addEventListener("change",function(){wm_changeCurrentFilter(e.options[e.selectedIndex].value,!0)})}function wm_onClickRoom(e){let t=wm_rooms[e];var i=$("#"+e);wm_single_bedid===e?(wm_single_bedid=null,$(i.domPlaySpeed).val(1).change(),$(i).attr("title",$(i).attr("tmp_title")),$(i).removeAttr("tmp_title"),clearInterval(wm_trend_interval),wm_trend_interval=null,wm_trend_range=4,$("#single-mode").modal("hide").contents().unwrap(),isMobile.iOS()&&($("#web-monitoring #content .container-fluid").css("padding-right","15px"),$("#web-monitoring #content .container-fluid").css("padding-left","15px")),t.isNavigating&&t.onClickNavigateLast(),$(t.domMenu).removeClass("d-none"),t.domRoot.style.width=$(wm_domRooms).innerWidth()/wm_layoutColumns+"px",t.domRoot.style.height="",t.domCanvas.style.width="100%",t.domCanvas.style.height="",$("body").css("cursor",""),$("#exit-"+e).removeClass("d-inline-block").addClass("d-none"),wm_changeLayoutColumns(wm_layoutColumns)):(wm_single_bedid=e,on_trend_data(),$(i).attr("tmp_title",$(i).attr("title")),$(i).attr("title",""),t.domRoot.style.width=window.innerWidth+"px",t.domRoot.style.height=window.innerHeight+"px",$(t.domMenu).addClass("d-none"),t.domControl.style.display="block",t.domControl.style.width=Math.floor((window.innerWidth-20)/2-9)+"px",$("#"+e).wrap("<div id='single-mode' class='wm-expanded modal fade' role='dialog' data-backdrop='false'></div>"),t.domCanvas.width=window.innerWidth-20,t.domCanvas.height=window.innerHeight-20,t.domCanvas.style.width=window.innerWidth-20+"px",t.domCanvas.style.height=window.innerHeight-20+"px",$("#exit-"+e).removeClass("d-none").addClass("d-inline-block"),isMobile.iOS()&&($("#single-mode").css("z-index",1050),$("#web-monitoring #content .container-fluid").css("padding","0")),$("#single-mode").modal("show"))}function wm_showMenu(e){if(!wm_single_bedid&&wm_isMember){var t=wm_rooms[e];if(null!=t.domViewerMenu&&$(t.domViewerMenu).hasClass("d-none")){for(e in wm_rooms)null!=wm_rooms[e].domViewerMenu&&$(wm_rooms[e].domViewerMenu).addClass("d-none");$(t.domViewerMenu).removeClass("d-none"),$(t.domViewerMenu).addClass("d-inline-block")}}}function wm_hideMenu(e){wm_single_bedid||!wm_isMember||null!=(e=wm_rooms[e]).domViewerMenu&&$(e.domViewerMenu).hasClass("d-inline-block")&&($(e.domViewerMenu).removeClass("d-inline-block"),$(e.domViewerMenu).addClass("d-none"))}function wm_formatValue(e,t){return"str"===t?4<e.length?e.slice(0,4):e:("str"==typeof e&&(e=parseFloat(e)),100<=Math.abs(e)||e-Math.floor(e)<.05?e.toFixed(0):e.toFixed(1))}function formatDate(e,t){return t?e.getDate()+" "+months[e.getMonth()]+" "+e.getHours()+":"+checkTime(e.getMinutes())+":"+checkTime(e.getSeconds())+"."+e.getMilliseconds():e.getDate()+" "+months[e.getMonth()]+" "+e.getHours()+":"+checkTime(e.getMinutes())+":"+checkTime(e.getSeconds())}function setPlaySpeed(e){e=parseInt(e),fastForward=1==e?0:(e-1)/60}function wm_room(e){this.dtplayer=wm_serverNow(),this.isVisible=!1,this.VRClockDiffToServer=null,this.navigationTimeDiffToRealtime=0,this.lastData=null,this.montype_trks={},this.groupid_trks={},this.dtlast=0,this.isNavigating=!1,this.isSliding=!1,this.isPaused=!1,this.bedid=e,this.bedname="",this.is_first_data=!0,this.vr_ipaddr=null,this.islinux=!1,this.room_height=0,this.filters=[],this.domRoot=document.getElementById(this.bedid),0<$(this.domRoot).find(".context-menu").length?(this.domMenu=$(this.domRoot).find(".context-menu")[0],this.domViewerMenu=$("#"+this.bedid+" .wm-info")[0]):this.domViewerMenu=$("#"+this.bedid+" .wm-viewer-menu")[0],this.domExpand=this.domRoot.getElementsByClassName("fa-window-maximize")[0],this.domControl=this.domRoot.getElementsByClassName("wm-control")[0],this.domCanvas=this.domRoot.getElementsByTagName("canvas")[0],$(this.domRoot).contextmenu(function(){event.preventDefault(),$(".context-menu").removeClass("show").hide();var e,t=$(this).find(".context-menu");0<t.length&&(e=$(this).offset(),$(t).css({display:"block",top:event.y+$(window).scrollTop()-e.top,left:event.x-e.left}).addClass("show"))}).hover(wm_showMenu.bind(null,this.bedid),wm_hideMenu.bind(null,this.bedid)).single_double_click(function(e){},function(e){wm_onClickRoom(this.id)}),this.domBtnPause=this.domRoot.getElementsByClassName("wm-pause")[0],this.domBtnPause.onclick=this.onClickPause.bind(this),this.domBtnResume=this.domRoot.getElementsByClassName("wm-resume")[0],this.domBtnResume.onclick=this.onClickResume.bind(this),this.domPlaySpeed=this.domRoot.getElementsByClassName("play-speed")[0],this.domBtnPrev=this.domRoot.getElementsByClassName("wm-prev")[0],this.domBtnPrev.onclick=this.onClickNavigatePrev.bind(this),this.domBtnNext=this.domRoot.getElementsByClassName("wm-next")[0],this.domBtnNext.onclick=this.onClickNavigateNext.bind(this),this.domBtnFirst=this.domRoot.getElementsByClassName("wm-first")[0],this.domBtnFirst.disabled=!1,this.domBtnFirst.onclick=this.onClickNavigateFirst.bind(this),this.domBtnLast=this.domRoot.getElementsByClassName("wm-last")[0],this.domBtnLast.onclick=this.onClickNavigateLast.bind(this),this.domTxtTime=this.domRoot.getElementsByClassName("wm-time")[0],this.domSlider=this.domRoot.getElementsByClassName("wm-slider")[0].getElementsByTagName("input")[0],this.domSlider.style.background="#d3d3d3";var i=this;this.domSlider.onchange=function(){0<i.domSlider.value?i.onClickNavigateLast():(i.sliderLastChangedAt=Date.now(),i.navigate(wm_serverNow()+parseFloat(i.domSlider.value)),i.isSliding=!1)},this.domSlider.oninput=function(){var e,t;0<i.domSlider.value?i.onClickNavigateLast():(e=new Date((new Date).getTime()+1e3*parseFloat(i.domSlider.value)),t=wm_isMobile?"<br>":"",t+=formatDate(e).substr(-8),i.domTxtTime.innerHTML=t,i.domTxtTime.style.color="white",i.sliderLastChangedAt=Date.now(),i.isSliding=!0)},this.ctx=document.createElement("canvas").getContext("2d")}function trend_data_on(){var c=wm_rooms[wm_single_bedid];$.ajax({url:"/trd_noti",type:"POST",data:{bedid:wm_single_bedid,range:wm_trend_range},dataType:"json",contentEncoding:"gzip",timeout:1e3*MAX_NETWORK_LATENCY,success:function(e,t,i){var a,o={vital:{},ane:{},filt:{}};for(a in e){var n=e[a].vital;for(s in n)void 0===o.vital[s]&&(o.vital[s]="NIBP_SBP"==s||"NIBP_DBP"==s||"ART_SBP"==s||"ART_DBP"==s?{}:[]),"NIBP_SBP"==s||"NIBP_DBP"==s||"ART_SBP"==s||"ART_DBP"==s?o.vital[s][a]=n[s]:o.vital[s].push({dt:a,val:n[s]});var s,r=e[a].ane;for(s in r){var l=s.substring(0,4);void 0===o.ane[l]&&(o.ane[l]=[]),o.ane[l].push({dt:a,val:r[s]})}var d,m=e[a].filt;for(d in m)void 0===o.filt[d]&&(o.filt[d]=[]),o.filt[d].push({dt:a,val:m[d].data[0][0].val})}"ART_MBP"in o.vital&&(o.filt.ART_MBP=o.vital.ART_MBP,delete o.vital.ART_MBP),c.trend_data=o},error:function(e,t,i){}})}function on_trend_data(){wm_single_bedid&&(trend_data_on(),wm_trend_interval=setInterval(trend_data_on,6e4))}function concat(e,t){let i=new Float32Array(e.length+t.length);return i.set(e),i.set(t,e.length),i}function prev_to_val(e){var t=e.recs[0].prev;e.recs[0].val=new Float32Array(t.length),void 0===e.mindisp&&(e.mindisp=1),void 0===e.maxdisp&&(e.maxdisp=99);for(var i=0;i<t.length;i++)0!=t[i]&&(e.recs[0].val[i]=t[i]*(e.maxdisp-e.mindisp)/99+e.mindisp)}function check_status(){var e=Object.keys(wm_rooms);bedSocket.connected&&bedSocket.emit("req_bed_status",e.join())}function update_room_visibility(){if(!wm_single_bedid){let e=0,t=0;var a,o=Cookies.get("WebMonitoring_patientOn"),n=Cookies.get("WebMonitoring_offline"),s=Cookies.get("WebMonitoring_online");let i;for(a in wm_rooms){var r=wm_rooms[a];i=!r.lastData||r.dtEnd+60<r.dtplayer,selected_groups.has(r.groupname)||selected_groups.size<=0?(o&&(!r.ptcon&&!r.isNavigating||i)||n&&!i||s&&i?$(r.domRoot).css("display","none"):$(r.domRoot).css("display","inline-block"),e++,0<r.ptcon&&!i&&t++):$(r.domRoot).css("display","none")}var l=document.getElementById("room-status");l&&(0<t?l.innerHTML="<font color='red'>"+t+"</font>/"+e+" beds":l.innerHTML=e+" beds")}}function wm_patientOn(e){var t=document.getElementById("wm-expand").getElementsByTagName("i")[0],i=document.getElementById("wm-offline");e.classList.contains("btn-light")||e.classList.contains("btn-gray")?(Cookies.set("WebMonitoring_patientOn","on"),Cookies.remove("WebMonitoring_offline"),Cookies.remove("WebMonitoring_online"),t.classList.contains("fa-expand-alt")?(e.classList.remove("btn-light"),e.classList.add("btn-primary"),i.classList.remove("btn-primary"),i.classList.add("btn-light"),$("#no-wifi").css("filter","")):(e.classList.remove("btn-gray"),e.classList.add("btn-light2"),i.classList.remove("btn-light2"),i.classList.add("btn-gray"),$("#no-wifi").css("filter","brightness(0) invert(1)"))):(wm_changeCurrentFilter(),Cookies.remove("WebMonitoring_patientOn"),t.classList.contains("fa-expand-alt")?(e.classList.remove("btn-primary"),e.classList.add("btn-light")):(e.classList.remove("btn-light2"),e.classList.add("btn-gray"))),check_status()}function wm_offlineOn(e){var t=document.getElementById("wm-expand").getElementsByTagName("i")[0],i=document.getElementById("wm-ptlabel"),a=$(e).prop("wifi-mode");"1"==a?($(e).prop("wifi-mode","0"),Cookies.set("WebMonitoring_offline",1),Cookies.remove("WebMonitoring_online"),Cookies.remove("WebMonitoring_patientOn"),t.classList.contains("fa-expand-alt")?$("#wifi-img").prop("src","/static/img/wifi-off-white.png"):$("#wifi-img").prop("src","/static/img/wifi-off.png")):"0"==a?(wm_changeCurrentFilter(),Cookies.remove("WebMonitoring_offline"),Cookies.remove("WebMonitoring_online"),$(e).prop("wifi-mode","2"),t.classList.contains("fa-expand-alt")?(e.classList.remove("btn-secondary"),e.classList.add("btn-light"),$("#wifi-img").prop("src","/static/img/wifi.png")):(e.classList.remove("btn-secondary"),e.classList.add("btn-gray"),$("#wifi-img").prop("src","/static/img/wifi-white.png"))):(Cookies.set("WebMonitoring_online",1),Cookies.remove("WebMonitoring_offline"),Cookies.remove("WebMonitoring_patientOn"),$(e).prop("wifi-mode","1"),t.classList.contains("fa-expand-alt")?(e.classList.remove("btn-light"),e.classList.add("btn-primary"),$("#wifi-img").prop("src","/static/img/wifi-white.png"),i.classList.remove("btn-primary"),i.classList.add("btn-light")):(e.classList.remove("btn-gray"),e.classList.add("btn-light2"),$("#wifi-img").prop("src","/static/img/wifi.png"),i.classList.remove("btn-light2"),i.classList.add("btn-gray"))),check_status()}function roundedRect(e,t,i,a,o,n=0){e.beginPath(),e.moveTo(t,i+n),e.lineTo(t,i+o-n),e.arcTo(t,i+o,t+n,i+o,n),e.lineTo(t+a-n,i+o),e.arcTo(t+a,i+o,t+a,i+o-n,n),e.lineTo(t+a,i+n),e.arcTo(t+a,i,t+a-n,i,n),e.lineTo(t+n,i),e.arcTo(t,i,t,i+n,n)}$(window).resize(function(){VIEW_HEIGHT=Math.max(document.documentElement.clientHeight,window.innerHeight)}),wm_room.prototype.onClickPause=function(){this.isNavigating=!0,this.isPaused=!0,this.domBtnPause.style.display="none",this.domBtnResume.style.display="inline-block",this.domBtnLast.disabled=!1,this.domBtnFirst.disabled=!1},wm_room.prototype.onClickResume=function(){this.isNavigating=!0,this.isPaused=!1,this.navigationTimeDiffToRealtime=this.dtplayer-wm_serverNow(),this.domBtnPause.style.display="inline-block",this.domBtnResume.style.display="none",this.domBtnLast.disabled=!1,this.domBtnFirst.disabled=!1},wm_room.prototype.get_display_time_length=function(){var e=800;return((e=wm_single_bedid&&wm_single_bedid==this.bedid?window.innerWidth/2:e)-PAR_WIDTH)/STANDARD_SAMPLE_RATE},wm_room.prototype.onClickNavigatePrev=function(){this.navigate(this.dtplayer-this.get_display_time_length())},wm_room.prototype.onClickNavigateNext=function(){this.navigate(Math.min(this.dtplayer+this.get_display_time_length(),wm_serverNow()))},wm_room.prototype.onClickNavigateFirst=function(){this.domBtnFirst.disabled=!0,this.navigate(Math.max(Math.round(Date.now()/1e3)-7200,this.dtcase-this.VRClockDiffToServer))},wm_room.prototype.onClickNavigateLast=function(){this.domSlider.value=0,this.onClickResume(),this.domBtnLast.disabled=!0,this.isNavigating=!1,this.navigationTimeDiffToRealtime=0,this.populateRoomData(0),$(this.domPlaySpeed).val(1).change()},wm_room.prototype.navigate=function(e){var t=e-wm_serverNow();this.domSlider.value=t;var i=new Date(1e3*e),t=wm_isMobile?"<br>":"";t+=formatDate(i),this.domTxtTime.innerHTML=t,this.domTxtTime.style.color="white",this.sliderLastChangedAt=Date.now(),this.onClickPause(),this.dtplayer=e,this.navigationTimeDiffToRealtime=this.dtplayer-wm_serverNow(),this.lastData&&this.dtplayer-this.get_display_time_length()-MAX_NETWORK_LATENCY>this.dtStart&&this.dtplayer+this.get_display_time_length()+MAX_NETWORK_LATENCY<this.dtEnd||this.populateRoomData(e)},wm_room.prototype.pushFilterData=function(e){if(e&&!(e.length<=0)&&this.lastData){for(var a in e){let t=e[a],i=null;for(var o in this.lastData.trks){var n=this.lastData.trks[o];if(t.id==n.id&&t.type==n.type){i=n;let e=t.recs.concat(i.recs);e.sort(function(e,t){return e.dt-t.dt});60<e.length&&e.splice(0,e.length-60),t.recs=e,this.lastData.trks[o]=t;break}}i||this.lastData.trks.push(t)}for(var t in this.groupid_trks={},this.montype_trks={},this.lastData.trks){var i,s=this.lastData.trks[t];void 0!==s.montype&&(this.montype_trks[s.montype]||(this.montype_trks[s.montype]=s),(i=montype_groupids[s.montype])&&(this.groupid_trks[i]||(this.groupid_trks[i]=[]),this.groupid_trks[i].push(s)))}}},wm_room.prototype.calc_display_latency=function(e){if(e.dtend||e.trks){var t,i,a=null;for(t in e.trks){var o=e.trks[t];"wav"==o.type&&(void 0===o.recs[0].val&&prev_to_val(o),this.is_first_data=!1,o=o.recs[0].dt+o.recs[0].val.length/o.srate,(!a||o<a)&&(a=o))}a?(1<(i=e.dtend-a)&&(this.display_latency=i),console.log(this.bedname,this.display_latency)):this.is_first_data=!0}},wm_room.prototype.get_status=function(e){if(this.is_standby=!0,e&&!(e.length<=0))for(var t in e)if("num"==e[t].type)return void(this.is_standby=!1)},wm_room.prototype.pushData=function(e){if(e&&e.trks&&!(this.lastData&&this.lastData.bedid===e.bedid&&this.lastData.seqid===e.seqid||this.lastData&&this.lastData.dtstart==e.dtstart&&this.lastData.dtend==e.dtend)){if(this.dtlast=e.dtserver||e.dtend,e.dtend&&e.dtserver&&null===this.VRClockDiffToServer&&(this.VRClockDiffToServer=e.dtend-e.dtserver),!this.lastData||this.lastData.bedid!=e.bedid||e.dtend<this.lastData.dtend||e.dtstart>this.lastData.dtend+10)this.lastData=e,this.dtStart=e.dtstart-this.VRClockDiffToServer,this.dtEnd=e.dtend-this.VRClockDiffToServer,this.dtcase=e.dtcase;else if(e.trks&&this.lastData.trks){for(var a in e.trks){let t=e.trks[a],i=null;for(var o in this.lastData.trks){var n=this.lastData.trks[o];if(t.id==n.id&&t.srate==n.srate&&t.type==n.type){i=n;break}}if(i)if("wav"===t.type&&t.recs&&0<t.recs.length&&i.recs&&0<i.recs.length){void 0===i.recs[0].val&&prev_to_val(i),void 0===t.recs[0].val&&prev_to_val(t);var s=i.recs[0],r=t.recs[0];Array.isArray(s.val)&&(s.val=new Float32Array(s.val)),Array.isArray(r.val)&&(r.val=new Float32Array(r.val));var l=Math.round((r.dt-s.dt)*t.srate);if(l<s.val.length)s.val=s.val.slice(0,l);else if(l>s.val.length){let e=new Float32Array(l);e.set(s.val),s.val=e}r.val=concat(s.val,r.val),r.dt=s.dt,delete s;l=(this.get_display_time_length()+this.display_latency)*STANDARD_SAMPLE_RATE*10;r.val.length>l&&(s=r.val.length,l=parseInt(r.val.length-l),r.val=r.val.slice(l),r.dt+=(s-r.val.length)/t.srate)}else if("wav"!=t.type){let e=t.recs.concat(i.recs);e.sort(function(e,t){return e.dt-t.dt});60<e.length&&e.splice(0,e.length-60),t.recs=e}}for(var t in this.lastData.trks){var i=this.lastData.trks[t];void 0!==i.montype&&-1<i.montype.indexOf("FILT")&&e.trks.filter(e=>e.montype===i.montype).length<=0&&e.trks.push(i)}this.dtEnd=Math.max(this.dtEnd,e.dtend-this.VRClockDiffToServer),this.dtStart=Math.max(this.dtStart,this.dtplayer-60,this.dtEnd-60),this.dtEnd=Math.max(this.dtStart,this.dtEnd),2.5<this.dtplayer-this.dtEnd&&this.dtplayer-this.dtEnd<60&&this.calc_display_latency(e)}if(e){if(this.groupid_trks={},this.montype_trks={},e.trks)for(var d in e.trks){var m,c=e.trks[d];null!=c.montype&&(this.montype_trks[c.montype]||(this.montype_trks[c.montype]=c),(m=montype_groupids[c.montype])&&(this.groupid_trks[m]||(this.groupid_trks[m]=[]),this.groupid_trks[m].push(c)))}this.lastData=e}}},wm_room.prototype.draw_title=function(t,i,e,a){t.fillStyle="#181818",t.fillRect(e,0,e+a,60),t.font="36px arial",t.fillStyle="#ffffff",!this.islinux&&i&&(t.fillStyle="#b1e0fc"),t.textAlign="left",t.textBaseline="alphabetic";var o,n=this.bedname.substring(0,11);if(i&&i.vrver&&vver_latest){var s=vver_latest.split("."),r=i.vrver.split("."),l=!1;for(k in s)if(+s[k]>+r[k]){l=!0;break}l&&(n+=".")}t.fillText(n,e+9,45),t.fillStyle="#ffffff";let d=e+t.measureText(n).width+20,m=e+t.measureText(n).width+20;if(!i||this.dtEnd+60<this.dtplayer)return this.lastData=null,t.filter="invert(1)",t.globalAlpha=.8,t.drawImage(img_offline,d,13,36,36),t.filter="",t.globalAlpha=1,d+=44,t.font="26px arial",t.fillStyle="#999999",t.textAlign="left",0<this.dtserver?(u=Math.floor(Date.now()/1e3-this.dtserver),c=[],0<(h=Math.floor(u/86400))&&c.push(h+"d"),0<(g=Math.floor(u/3600)%24)&&c.push(g+"h"),p=Math.floor(u/60)%60,c.length<2&&c.push(p+"m"),_=u%60,c.length<2&&c.push(_+"s"),t.fillText(c.join(" "),d,45)):t.fillText("N/A",d,45),$(this.domMenu).find("a.cmd-"+this.shareid).addClass("disabled"),!1;if(i){0<$(this.domMenu).find("a.cmd-"+this.shareid).length&&wm_serverNow()>=i.dtapp?$(this.domMenu).find("a.cmd-"+this.shareid).removeClass("disabled"):$(this.domMenu).find("a.cmd-"+this.shareid).addClass("disabled"),this.ptcon&&(t.font='800 24px "Font Awesome 5 Free"',t.fillText("ï†ƒ",d,42),d+=22,m+=22),this.hid&&(t.font="24px arial",t.fillStyle="white",t.textAlign="right",t.textBaseline="alphabetic",t.fillText(this.hid,a-10,45));var c,p,g,h,_,u=Math.floor(Math.max(0,this.dtplayer-this.dtcase+this.VRClockDiffToServer));0<this.dtcase&&(t.font="26px arial",t.fillStyle="white",t.textAlign="left",t.textBaseline="alphabetic",this.isNavigating&&(c=(c=new Date(1e3*this.dtplayer)).getHours()+":"+checkTime(c.getMinutes())+":"+checkTime(c.getSeconds()),t.fillText(c,d,45),d+=t.measureText(c).width+10,m+=t.measureText(c).width+10),t.fillStyle=i.recording?"red":"white",_=u%60,p=Math.floor(u/60)%60,g=Math.floor(u/3600)%24,h=Math.floor(u/86400),_=_+"s",(0<p||0<g||0<h)&&(_=p+"m "+_),(0<g||0<h)&&(_=g+"h "+_),0<h&&(_=h+"d "+_),t.fillText(_,d,45),d+=t.measureText(_).width+10,m+=t.measureText(_).width+10);var f=35,v=!1;if(t.font="15px arial",t.textAlign="left",t.textBaseline="alphabetic",i.devs)for(var w in i.devs){let e=i.devs[w];!v&&d+17+t.measureText(e.name.substr(0,7)).width>a-t.measureText(this.hid).width-20&&(v=!0,d=m,f-=23),"on"===e.stauts||"on"===e.status?t.fillStyle="#348ec7":t.fillStyle="red",roundedRect(t,d,f,12,12,3),t.fill(),d+=17,t.fillStyle="white",t.fillText(e.name.substr(0,7),d,f+12),d+=t.measureText(e.name.substr(0,7)).width+13}if(i.filts)for(var y in i.filts){var b=i.filts[y];!v&&d+17+t.measureText(b.name.substr(0,7)).width>a-t.measureText(this.hid).width-20&&(v=!0,d=m,f-=20),t.fillStyle="#c388c3",roundedRect(t,d,f,12,12,3),t.fill(),d+=17,t.fillStyle="white",t.fillText(b.name.substr(0,7),d,f+12),d+=t.measureText(b.name.substr(0,7)).width+13}if(this.is_standby&&!this.isNavigating){t.globalAlpha=.4,t.drawImage(img_vitaldb_logo,(e+a-193.75)/2,105,193.75,50),t.globalAlpha=1;for(var T="Waiting for next patient ",C=Math.floor(Date.now()/1e3)%4,k=0;k<C;k++)T+=".";return t.textAlign="left",t.font="22px arial",t.fillStyle="#cccccc",t.fillText(T,(e+a)/2-105,185),!(t.globalAlpha=1)}}return this.isNavigating?1e3<Date.now()-(this.sliderLastChangedAt||0)&&(e=new Date(Date.now()-1e3*(wm_serverNow()-this.dtplayer)),o=wm_isMobile?"<br>":"",o+=formatDate(e),this.domTxtTime.innerHTML=o,this.domTxtTime.style.color="#bbbbbb"):this.isSliding||(o=formatDate(new Date(Date.now()-1e3*this.display_latency)),this.domTxtTime.innerHTML=o,this.domTxtTime.style.color="#bbbbbb"),!0},wm_room.prototype.draw_trend_border=function(e,t){e.lineWidth=.5,e.strokeStyle="#808080",e.beginPath(),e.moveTo(this.domCanvas.width/2,0),e.lineTo(this.domCanvas.width/2,this.domCanvas.height),e.stroke();var i=t.padding,a=(t.bottom-2*t.padding)/2;e.beginPath(),e.moveTo(t.left+t.padding,i),e.lineTo(t.right-t.padding,i),e.lineTo(t.right-t.padding,i+a-t.padding/2),e.lineTo(t.left+t.padding,i+a-t.padding/2),e.lineTo(t.left+t.padding,i),e.stroke(),e.font="12px Arial",e.fillStyle="white",e.textBaseline="bottom";var o=new Date,n=o.getMinutes(),s=o.getHours()-wm_trend_range;0<n&&(s+=1);for(var r=t.padding,l=(t.right-t.left-2*t.padding)/4,d=r;d<=t.right-t.padding;d+=l)d==t.padding?e.textAlign="left":d==t.right-t.padding?e.textAlign="right":(e.textAlign="center",e.beginPath(),e.moveTo(d,i),e.lineTo(d,i+a-t.padding/2),e.stroke()),s<0&&(s+=24),24<=s&&(s-=24),e.fillText(s+":00",d,i),s++;l=(a-t.padding/2)/4;for(var m=200,c=39,d=i;d<=a+t.padding/2;d+=l)d==i?e.textBaseline="top":d==a+t.padding/2?e.textBaseline="bottom":(e.textBaseline="middle",e.beginPath(),e.moveTo(r,d),e.lineTo(t.right-t.padding,d),e.stroke()),e.textAlign="right",e.textBaseline="middle",e.fillText(m,r,d),e.textAlign="left",e.textBaseline="middle",e.fillText(c,t.right-t.padding,d),m-=50,c--;i+=a+t.padding/2,a/=2,e.beginPath(),e.moveTo(t.left+t.padding,i),e.lineTo(t.right-t.padding,i),e.lineTo(t.right-t.padding,i+a-t.padding/2),e.lineTo(t.left+t.padding,i+a-t.padding/2),e.lineTo(t.left+t.padding,i),e.stroke(),e.textAlign="right",e.textBaseline="top",e.fillText(10,r,i),e.textBaseline="bottom",e.fillText(0,r,i+a-t.padding/2);for(d=r+(l=(t.right-t.left-2*t.padding)/4);d<t.right-t.padding;d+=l)e.beginPath(),e.moveTo(d,i),e.lineTo(d,i+a-t.padding/2),e.stroke();i+=a+t.padding/2,e.beginPath(),e.moveTo(t.left+t.padding,i),e.lineTo(t.right-t.padding,i),e.lineTo(t.right-t.padding,i+a-t.padding/2),e.lineTo(t.left+t.padding,i+a-t.padding/2),e.lineTo(t.left+t.padding,i),e.stroke(),e.textBaseline="top",e.fillText(100,r,i),e.textBaseline="bottom",e.fillText(0,r,i+a-t.padding/2);for(d=r+l;d<t.right-t.padding;d+=l)e.beginPath(),e.moveTo(d,i),e.lineTo(d,i+a-t.padding/2),e.stroke()},wm_room.prototype.draw_trend_legend=function(e,t,i,a){var o,n={vital:["BIS","BT","PLETH_SPO2","HR","ART_SBP","NIBP_SBP"],ane:["REMI","PROP","SEVO","DESF"],filt:["ART_MBP","filters.abp_hpi"]};for(o in n[a]){var s=n[a][o],r=wm_trend[a][s].name,s=wm_trend[a][s].color;e.font="12px Arial",e.fillStyle="white",e.textBaseline="top",e.textAlign="right",e.fillText(r,t,i),e.fillStyle=s,roundedRect(e,t-e.measureText(r).width-15,i-1,12,12,3),e.fill(),t-=e.measureText(r).width+20}},wm_room.prototype.draw_trend_data=function(e,t){if(void 0!==this.trend_data){var i=(t.right-t.left-2*t.padding)/(60*wm_trend_range),a=(new Date).getMinutes(),o=wm_trend_range;0<a&&o--;var n=3600*Math.floor((new Date/1e3-3600*o)/3600);this.isNavigating||this.isSliding||((o=0)<a&&o++,b=3600*Math.floor((new Date/1e3+3600*o)/3600)-new Date/1e3,$(this.domSlider).attr("max",b).attr("min",-14400+b).val(0));var s,r,l,d,m,c,p=!(e.lineWidth=1.5),g=!1,h=(t.bottom-3*t.padding)/2,_=(t.bottom-t.padding)/2,a=_-h+5,o=t.right-t.padding-5;for(r in this.draw_trend_legend(e,o,a,"vital"),wm_trend.vital)if(void 0!==(m=this.trend_data.vital[r]))if("NIBP_SBP"!=r&&"NIBP_DBP"!=r&&"ART_SBP"!=r&&"ART_DBP"!=r){e.strokeStyle=wm_trend.vital[r].color,e.beginPath();for(var u=!0,f=t.padding,v=0;v<m.length-1;v++){var w=m[v],y=m[v+1];w.val<0&&(w.val=0),y.val<0&&(y.val=0),200<w.val&&(w.val=200),200<y.val&&(y.val=200),"BT"==r&&(w.val<35&&(w.val=35),y.val<35&&(y.val=35),39<w.val&&(y.val=39),39<y.val&&(w.val=39)),w.dt<n||y.dt<n||(px1=t.padding+(w.dt-n)/60*i,px2=t.padding+(y.dt-n)/60*i,px_m=(px1+px2)/2,px_cp1=(px_m+px1)/2,px_cp2=(px_m+px2)/2,py1=_-h*w.val/200,py2=_-h*y.val/200,"BT"==r&&(py1=_-h*(w.val-35)/4,py2=_-h*(y.val-35)/4),py_m=(py1+py2)/2,u?(px1<t.padding+10?(e.moveTo(t.padding,py1),e.lineTo(px1,py1)):e.moveTo(px1,py1),u=!1):px2-px1>t.padding+10||px1-f>t.padding+10?(e.stroke(),e.beginPath(),e.moveTo(px1,py1)):(e.quadraticCurveTo(px_cp1,py1,px_m,py_m),e.quadraticCurveTo(px_cp2,py2,px2,py2)),f=px1)}e.stroke()}else{if(-1<r.indexOf("NIBP")){if(g)continue;l="NIBP",g=!0}else{if(p)continue;l="ART",p=!0}e.fillStyle=wm_trend.vital[r].color;var b,T,C,k=this.trend_data.vital[l+"_SBP"],x=this.trend_data.vital[l+"_DBP"];if(void 0!==k&&void 0!==x)for(b in k)b<n||((T=200<(T=k[b])?200:T)<0&&(T=0),(C=200<(C=x[b])?200:C)<0&&(C=0),(s=t.padding+(b-n)/60*i)+i>t.right-t.padding||(py=_-h*T/200,e.fillRect(s,py,i,T-C)))}for(d in h=t.bottom/4-t.padding,a=(_=3*t.bottom/4-t.padding/2)-h+5,o=t.right-t.padding-5,this.draw_trend_legend(e,o,a,"ane"),wm_trend.ane)if(void 0!==(m=this.trend_data.ane[d]))for(var v in e.fillStyle=wm_trend.ane[d.toUpperCase()].color,m)(E=m[v]).val<0&&(E.val=0),10<E.val&&(E.val=10),E.dt<n||(s=t.padding+(E.dt-n)/60*i)+i>t.right-t.padding||(py=_-h*E.val/10,e.fillRect(s,py,i,_-py));for(c in h=t.bottom/4-t.padding,a=(_=t.bottom-t.padding/2)-h+5,o=t.right-t.padding-5,this.draw_trend_legend(e,o,a,"filt"),wm_trend.filt){var E,A=this.trend_data.filt[c];if(void 0!==A)if("bar"==wm_trend.filt[c].type)for(var v in e.fillStyle=wm_trend.filt[c].color,A)(E=A[v]).val<0&&(E.val=0),100<E.val&&(E.val=100),E.dt<n||(s=t.padding+(E.dt-n)/60*i)+i>t.right-t.padding||(py=_-h*E.val/100,e.fillRect(s,py,i,_-py));else{e.strokeStyle=wm_trend.filt[c].color,e.beginPath();for(u=!0,f=t.padding,v=0;v<A.length-1;v++){w=A[v],y=A[v+1];w.val<0&&(w.val=0),y.val<0&&(y.val=0),100<w.val&&(w.val=100-i),100<y.val&&(y.val=100-i),w.dt<n||y.dt<n||(px1=t.padding+(w.dt-n)/60*i,px2=t.padding+(y.dt-n)/60*i,px_m=(px1+px2)/2,px_cp1=(px_m+px1)/2,px_cp2=(px_m+px2)/2,py1=_-h*w.val/100,py2=_-h*y.val/100,py_m=(py1+py2)/2,u?(px1<t.padding+10?(e.moveTo(t.padding,py1),e.lineTo(px1,py1)):e.moveTo(px1,py1),u=!1):px2-px1>t.padding+10||px1-f>t.padding+10?(e.stroke(),e.beginPath(),e.moveTo(px1,py1)):(e.quadraticCurveTo(px_cp1,py1,px_m,py_m),e.quadraticCurveTo(px_cp2,py2,px2,py2)),f=px1)}e.stroke()}}e.strokeStyle="rgba(0, 153, 255, .5)",e.lineWidth=i,s=t.right-t.padding-parseFloat(this.domSlider.max-this.domSlider.value)*(e.width/2-2*t.padding)/14400,e.beginPath(),e.moveTo(s,t.padding),e.lineTo(s,t.bottom-t.padding/2),e.stroke()}},wm_room.prototype.draw_track=function(n,s,r,l,d,m){if(s&&s.srate&&s.recs&&s.recs.length){var c=s.recs[0];if(c.val&&c.val.length){n.beginPath();let e=r,t=0,i=!0,a=0,o=r+d-parseInt((this.dtplayer-(c.dt-this.VRClockDiffToServer)-this.display_latency)*s.srate);o<r&&(a=-parseInt(o-r),o=r);var p=c.val;if(void 0!==p){for(var g=p.length;a<g;o++,a++){var h=p[a];if(0!=h){if(h=(h-s.mindisp)/(s.maxdisp-s.mindisp),o>r+d)break;t=l+m-h*m,t<l&&(t=l),t>l+m&&(t=l+m),i?(o<r+10?(n.moveTo(r,t),n.lineTo(o,t)):n.moveTo(o,t),i=!1):o-e>r+10?(n.stroke(),n.beginPath(),n.moveTo(o,t)):n.lineTo(o,t),e=o}}!i&&o>r+d-10&&n.lineTo(r+d,t),n.stroke(),i||o>r+d-4&&(n.fillStyle="white",n.fillRect(r+d-4,t-2,4,4))}}}},wm_room.prototype.draw=function(){let t=this.domCanvas.getContext("2d"),e=new Set,i=800;if(wm_single_bedid){if(wm_single_bedid!==this.bedid)return;i=window.innerWidth}let a=1;var o;t.canvas.clientWidth<250&&(a=250/t.canvas.clientWidth),t.canvas.clientHeight!=parseInt(t.canvas.clientWidth*this.room_height/i)&&(t.canvas.height=parseFloat(t.canvas.clientWidth*this.room_height/i)*a),this.domCanvas.clientWidth=this.domCanvas.clientWidth.toFixed(2),this.domCanvas.clientHeight=this.domCanvas.clientHeight.toFixed(2),t.width!=this.domCanvas.clientWidth*a&&(t.width=this.domCanvas.clientWidth*a),t.height!=this.domCanvas.clientHeight*a&&(t.height=this.domCanvas.clientHeight*a),t.canvas.width!=this.domCanvas.clientWidth*a&&(t.canvas.width=this.domCanvas.clientWidth*a),t.canvas.height!=this.domCanvas.clientHeight*a&&(t.canvas.height=this.domCanvas.clientHeight*a),t.fillStyle="#000000",t.fillRect(0,0,t.width,t.height),t.save(),t.scale(t.width/i,t.width/i),wm_single_bedid==this.bedid&&(o={top:0,right:t.width/2,bottom:t.height-75,left:0,padding:30},this.draw_trend_border(t,o),this.draw_trend_data(t,o));var n=this.lastData;let s=wm_single_bedid?i/2:0,r=65;var l=(wm_single_bedid?i/2:i)-PAR_WIDTH;if(!this.draw_title(t,n,s,i))return this.room_height=270,void t.restore();var d,m,c,p;for(p in wm_groups)(v=wm_groups[p]).wav&&(d=v.name,(m=this.montype_trks[v.wav])&&(m&&m.srate&&m.recs&&m.recs.length&&(e.add(m.id),d=m.name),!this.draw_par_box(v,t,s+l,r,e)&&"ECG_II"!=d&&"PLETH"!=d&&"ECG"!=d&&"CO2_WAV"!=d||(c="IABP_WAV"===m.montype,rch=c?1.5*PAR_HEIGHT:PAR_HEIGHT,t.lineWidth=2.5,t.strokeStyle=v.fgColor,this.draw_track(t,m,s,r+5,l,rch-10),t.lineWidth=.5,t.strokeStyle="#808080",t.beginPath(),t.moveTo(s,r+rch),t.lineTo(s+l,r+rch),t.stroke(),c&&(t.beginPath(),t.strokeStyle="#c8c8c8",t.setLineDash([5,15]),t.lineWidth=2.5,t.font="12px Arial",t.fillStyle="white",t.textAlign="right",t.textBaseline="top",t.fillText("160",i-PAR_WIDTH-3,r+8),c=r+rch/3+5,t.moveTo(s,c),t.lineTo(i-PAR_WIDTH-37.5,c),t.textBaseline="middle",t.fillText("120",i-PAR_WIDTH-3,c),c=r+2*rch/3-5,t.moveTo(s,c),t.lineTo(i-PAR_WIDTH-37.5,c),t.fillText("80",i-PAR_WIDTH-3,c),t.textBaseline="bottom",t.fillText("40",i-PAR_WIDTH-3,r+rch-8),t.stroke(),t.setLineDash([])),t.font="14px Arial",t.fillStyle="white",t.textAlign="left",t.textBaseline="top",t.fillText(d,s+3,r+9),r+=rch)));if(n.evts&&n.evts.length){this.draw_par_box(null,null,t,l,r,e);var g=0;t.font="14px arial",t.textAlign="left",t.textBaseline="alphabetic";for(let e=n.evts.length-1;0<=e;--e){var h=n.evts[e];t.fillStyle="#4EB8C9";var _=new Date(1e3*h.dt),u=_.getHours(),_=("0"+_.getMinutes()).substr(-2);t.fillText(u+":"+_,s+l+3,r+20+20*g),t.fillStyle="white",t.fillText(h.val,s+l+45,r+20+20*g),g+=1}}s=wm_single_bedid?i/2:0;let f=!0;for(p in wm_groups){var v=wm_groups[p],w=this.montype_trks[v.wav];if(!(w&&w.recs&&0<w.recs.length)&&(this.draw_par_box(v,t,s,r,e)&&(s+=PAR_WIDTH,s>i-2*PAR_WIDTH))){if(s=wm_single_bedid?i/2:0,r+=PAR_HEIGHT,!f&&!wm_single_bedid&&!wm_isMobile)break;if(wm_single_bedid&&r+PAR_HEIGHT>t.height)break;f=!1}}wm_single_bedid!=this.bedid&&(s&&(r+=PAR_HEIGHT),this.room_height!=r&&(this.room_height=r)),t.restore()},wm_room.prototype.draw_par_box=function(e,t,i,a,o){let n=!1;if(!e)return!1;if(!e.param)return!1;var s,r=wm_paramLayouts[e.paramLayout],l=[];if(!r)return!1;for(s in e.param){var d=e.param[s],m=this.montype_trks[d];if(m&&m.recs&&!o.has(m.id)){for(var c=void 0,p=m.recs.length-1;0<=p;--p){var g=m.recs[p],h=g.dt-this.VRClockDiffToServer;if(h<this.dtplayer-300)break;if(!(h>this.dtplayer&&g.val)&&(void 0!==g.val&&null!==g.val)){c=g.val;break}}void 0!==c?(c=wm_formatValue(c,m.type),l.push({name:m.name,value:c}),n=!0):l.push({name:m.name,value:""}),o.add(m.id)}}if(!n)return!1;e.name&&"AGENT"===e.name.substring(0,5)&&1<l.length&&("DESF"===l[1].value.toUpperCase()?l[1].value="DES":"ISOF"===l[1].value.toUpperCase()?l[1].value="ISO":"ENFL"===l[1].value.toUpperCase()&&(l[1].value="ENF")),"MASIMO"===e.name&&2<l.length&&(l[1].name="SEF",l[1].value=l[1].value?Math.round(l[1].value):"",l[1].value=l[2].value?l[1].value+"/"+Math.round(l[2].value):l[1].value,l.pop()),"BP"===e.paramLayout&&2<l.length?(l[0].name=e.name||"",l[0].value=(l[0].value?Math.round(l[0].value):" ")+(l[1].value?"/"+Math.round(l[1].value):" "),l[2].value=l[2].value?Math.round(l[2].value):"",l[1]=l[2],l.pop()):0<l.length&&!l[0].name&&(l[0].name=e.name||""),"VNT"===e.paramLayout&&3<l.length&&(l[0].name=e.name,l[0].value=l[0].value?Math.round(l[0].value):"",l[1].value=l[1].value?Math.round(l[1].value):"",l[2].value=l[2].value?Math.round(l[2].value):"",l[2].value=l[3].value?l[2].value+" ("+Math.round(l[3].value)+")":l[2].value+"\t ",l.pop());for(var _=0;_<r.length&&_<l.length;_++){var u,f,v=r[_];v.value&&v&&(t.font=v.value.fontsize+"px arial",t.fillStyle=e.fgColor,"HPI"==l[0].name&&"TWO"==e.paramLayout&&(t.fillStyle="#00FFFF"),e.name&&"AGENT"===e.name.substring(0,5)&&1<l.length&&("DES"===l[1].value?t.fillStyle="#2296E6":"ISO"===l[1].value?t.fillStyle="#DDA0DD":"ENF"===l[1].value&&(t.fillStyle="#FF0000")),t.textAlign=v.value.align||"left",t.textBaseline=v.value.baseline||"alphabetic",t.fillText(l[_].value,i+v.value.x,a+v.value.y)),v.name&&(t.font="14px arial",t.fillStyle="white",t.textAlign=v.name.align||"left",t.textBaseline=v.name.baseline||"alphabetic",u=l[_].name,75<(f=t.measureText(u).width)?(t.save(),t.scale(75/f,1),t.fillText(u,(i+v.name.x)*f/75,a+v.name.y),t.restore()):t.fillText(u,i+v.name.x,a+v.name.y))}t.strokeStyle="#808080",t.lineWidth=.5;var w="ART"==e.name?1.5*PAR_HEIGHT:PAR_HEIGHT;return roundedRect(t,i,a,PAR_WIDTH,w),t.stroke(),e.param[0]&&"FILT"==e.param[0].substring(0,4)&&(t.beginPath(),t.moveTo(i+PAR_WIDTH,a),t.lineTo(i+PAR_WIDTH-12,a),t.lineTo(i+PAR_WIDTH,a+12),t.fillStyle="#c8c8c8",t.fill()),!0},wm_room.prototype.populateRoomData=function(e){this.lastData=null,this.dtStart=0,this.dtEnd=0,this.ptcon=0,e?(this.dtlast=e-this.get_display_time_length()-this.display_latency,this.dtplayer=e):(this.dtlast=0,this.dtplayer=wm_serverNow()-this.display_latency),request_room_data()};var was_first=!0;function request_room_data(){let t={},i=1;if(wm_single_bedid){let e=wm_rooms[wm_single_bedid];if(i=Math.ceil((e.get_display_time_length()+e.display_latency)/e.display_latency),e.is_websocket&&!e.isNavigating)return;if(!(e.dtlast<e.dtplayer))return;t[wm_single_bedid]=e.dtlast}else for(var e in wm_rooms){var a=wm_rooms[e];a.is_websocket&&0<a.dtlast||!selected_groups.has(a.groupname)&&0<selected_groups.size||!check_visible(a.domCanvas)||(t[e]=a.dtlast,a.dtplayer-a.dtlast>=2*a.display_latency&&(t[e]=null))}Object.keys(t).length<=0||bedSocket.emit("req_prev_data",JSON.stringify(t),i)}var update_frame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||function(e){return window.setTimeout(e,1e3/60)},last_render=0;function redraw_rooms(){update_frame(redraw_rooms);var e=Date.now();if(30<e-last_render)for(var t in this.last_render=e,wm_rooms)if(!wm_single_bedid||wm_single_bedid===t){let e=wm_rooms[t];"none"!=e.domRoot.style.display&&check_visible(e.domCanvas)&&(e.isPaused||(e.isNavigating?(e.dtplayer=wm_serverNow()+e.navigationTimeDiffToRealtime,e.navigationTimeDiffToRealtime+=fastForward,e.dtplayer>=wm_serverNow()-e.display_latency&&$(e.domPlaySpeed).val(1).change()):e.dtplayer=wm_serverNow()-e.display_latency),e.draw())}}function join_rooms(){if(bedSocket.connected)for(var e in wm_rooms){var t=wm_rooms[e];t.is_websocket&&!t.isVisible&&check_visible(t.domCanvas)&&(bedSocket.emit("join_bed",e,wm_rooms[e].shareid),t.isVisible=!0)}}function display_txtTime(){var e;wm_single_bedid&&(e=wm_rooms[wm_single_bedid],$(e.domRoot).find(".wm-timeX")[0].innerHTML=(0<txtTime.length?"Rewind to ":"")+txtTime),setTimeout(display_txtTime,100)}function rewrite_room_title(e,t,i){var a=wm_rooms[e];$("#"+e).attr("title",a.bedname+" ("+a.shareid+") "+t+" "+i+(a.islinux?"":" (Windows)")),a.vrver=t}update_frame(redraw_rooms),$(document).ready(function(){var t,i,e,a=document.getElementsByClassName("wm-room"),o=!1;for(t in a){let e=a[t];e&&((i=e.id)&&((i=new wm_room(i)).bedname=e.getAttribute("name"),i.groupname=e.getAttribute("group"),""==i.groupname&&(i.groupname="Unspecified",o=!0),i.shareid=e.getAttribute("shareid"),i.is_websocket=parseInt(e.getAttribute("websocket")),i.display_latency=parseInt(e.getAttribute("latency")),i.dtplayer-=i.display_latency,wm_rooms[i.bedid]=i))}for(e in o||($("#groupfilter option[value='Unspecified']").remove(),$(".group-Unspecified").remove()),wm_isMember="1"===document.getElementById("wm-member").innerHTML,vver_latest=document.getElementById("vver_latest").value,setInterval(function(){$.ajax({url:"/refresh_session",cache:!1})},12e5),setInterval(function(){$(".modal.show").length<=0&&location.reload()},36e5),wm_isMobile||setInterval(currentTime.bind(null),500),setInterval(wm_resizeRoomHeight,1e3),wm_groups){var n,s=wm_groups[e];for(n in s.param){var r=s.param[n];montype_groupids[r]=e}s.wav&&(montype_groupids[s.wav]=e)}var l=parseFloat(document.getElementById("wm-now").innerHTML);if(wm_localClockDiffToServer=Date.now()/1e3-(l+.5),document.addEventListener("keydown",function(e){27==e.keyCode&&(wm_single_bedid?wm_onClickRoom(wm_single_bedid):$("form").trigger("reset")),13!=e.keyCode||!wm_single_bedid||void 0!==(e=wm_rooms[wm_single_bedid]).shareid&&add_event(e.bedname,e.bedid,e.shareid)}),document.addEventListener("click",function(e){$(".context-menu").removeClass("show").hide(),200<e.clientX&&$("#group-filter-side-tab").hasClass("show-tab")&&closeGFTab()}),$(window).scroll(function(){0==$(window).scrollTop()?$("#toolbar").css("padding-top",0):$("#toolbar").css("padding-top","5px")}),0<$(".wm-room").length){wm_layoutColumns=Math.min(wm_isMember?wm_isMobile?3:5:1,a.length),wm_initLayoutButtons();l=Cookies.get("WebMonitoring_currentFilter");l&&l.split(",").forEach(function(e){0<$("#"+$.escapeSelector(e)).length&&(selected_groups.add(e),$("#"+$.escapeSelector(e)).prop("checked",!0))});l=Cookies.get("WebMonitoring_layoutColumns");l&&(wm_layoutColumns=parseInt(l)),wm_changeCurrentFilter(),wm_changeLayoutColumns(wm_layoutColumns,!0),window.addEventListener("resize",wm_onResizeWindow),Cookies.get("WebMonitoring_expanded")&&$("#wm-expand").click(),Cookies.get("WebMonitoring_patientOn")&&(g=document.getElementById("wm-ptlabel"),Cookies.get("WebMonitoring_expanded")?(g.classList.remove("btn-gray"),g.classList.add("btn-light2")):(g.classList.remove("btn-light"),g.classList.add("btn-primary"))),(Cookies.get("WebMonitoring_offline")||Cookies.get("WebMonitoring_online"))&&(p=document.getElementById("wm-offline"),Cookies.get("WebMonitoring_expanded")?(p.classList.remove("btn-gray"),p.classList.add("btn-light2"),Cookies.get("WebMonitoring_offline")&&($("#wifi-img").prop("src","/static/img/wifi-off.png"),$("#wm-offline").prop("wifi-mode","0")),Cookies.get("WebMonitoring_online")&&($("#wifi-img").prop("src","/static/img/wifi.png"),$("#wm-offline").prop("wifi-mode","1"))):(p.classList.remove("btn-light"),p.classList.add("btn-primary"),Cookies.get("WebMonitoring_offline")&&($("#wifi-img").prop("src","/static/img/wifi-off-white.png"),$("#wm-offline").prop("wifi-mode","0")),Cookies.get("WebMonitoring_online")&&($("#wifi-img").prop("src","/static/img/wifi-white.png"),$("#wm-offline").prop("wifi-mode","1")))),display_txtTime();try{bedSocket=io(websocket_host,{transports:["websocket"],reconnection:!1,forceNew:!0});function d(){30<=m&&(clearInterval(c),console.log("Cannot connect to websocket server")),0==bedSocket.connected&&(m+=1,console.log("reconnecting..."),bedSocket.connect())}var m=0,c=null;bedSocket.connected||setInterval(d,2e3),bedSocket.on("connect",function(){for(var e in clearInterval(c),c=null,m=0,console.log("connected"),wm_rooms)bedSocket.emit("join_bed",e,wm_rooms[e].shareid)}),bedSocket.on("disconnect",function(){console.log("disconnected"),c=setInterval(d,2e3)}),bedSocket.on("recv_data",function(e){e=pako.inflate(e,{to:"string"});var t=JSON.parse(e),i=Object.keys(t)[0],e=wm_rooms[i];if(!check_visible(e.domCanvas))return bedSocket.emit("leave_bed",i),void(e.isVisible=!1);if((wm_single_bedid!=i||!e.isNavigating)&&(e.is_first_data&&e.calc_display_latency(t[i]),e.dtcase=t[i].dtcase||0,e.dtserver=t[i].dtserver,e.ptcon=parseInt(t[i].ptcon)||0,e.get_status(t[i].trks),t[i].hid&&"Y"==admin_yn&&(e.hid=t[i].hid),(t[i].vrver!=e.vrver||t[i].islinux&&t[i].islinux!=e.islinux)&&(e.vrver=t[i].vrver,e.islinux=t[i].islinux,rewrite_room_title(e.bedid,t[i].vrver,e.vr_ipaddr)),e.pushData(t[i]),e.show_log)){var a="",o=["roomname","ptcon","devs","trks","syslog"];if(e.is_first_show){for(var n=0;n<o.length;n++){var s=t[i][o[n]];void 0===s&&(s=""),"object"==typeof(s="trks"==o[n]?s.map(function(e){return{name:e.name,montype:e.montype,type:e.type}}):s)&&(s=JSON.stringify(s)),a+=o[n]+": "+s+"\n"}delete e.is_first_show}else void 0!==t[i].syslog&&(a=t[i].syslog);a.length&&console.log(a)}}),bedSocket.on("recv_filter",function(e){e=pako.inflate(e,{to:"string"});var a=JSON.parse(e),e=Object.keys(a)[0],a=a[e],o=wm_rooms[e],n=[];a.outputs.forEach(function(e,t){var i;t<2&&(o.filters.indexOf(a.filter)<0&&o.filters.push(a.filter),i=o.filters.indexOf(a.filter)+1,e.id=2*i+t+1,e.montype="FILT"+(i+1)+"_"+(t+1),e.recs=a.data[t],n.push(e))}),o.pushFilterData(n)}),bedSocket.on("recv_vrconf",function(e,t){$("[name=dev-advanced-setting]").val(t)}),bedSocket.on("res_json",function(e,t){devices=e,filters=t}),bedSocket.on("res_bed_status",function(e){var t,i=Cookies.get("WebMonitoring_patientOn"),a=Cookies.get("WebMonitoring_offline"),o=Cookies.get("WebMonitoring_online"),n=0,s=0;for(t in e){var r=wm_rooms[t],l=+e[t].utime;void 0===r.dtserver&&(r.dtserver=l),r.is_offline=60+l<r.dtplayer,r.ptcon=parseInt(+e[t].ptcon),(selected_groups.has(r.groupname)||selected_groups.size<=0)&&(i&&(!r.ptcon&&!r.isNavigating||r.is_offline)||a&&!r.is_offline||o&&r.is_offline?$(r.domRoot).css("display","none"):$(r.domRoot).css("display","inline-block"),n++,0<r.ptcon&&!r.is_offline&&s++)}var d=document.getElementById("room-status");d&&(d.innerHTML="<font color='red'>"+s+"</font>/"+n+" beds")}),bedSocket.on("res_prev_data",function(e){e=pako.inflate(e,{to:"string"});var i=JSON.parse(e);if(!(Object.keys(i).length<=0)){for(var a in i){let t=wm_rooms[a],e=i[a];e.forEach(function(e){e=JSON.parse(e),!wm_single_bedid&&e.dtend&&e.dtserver&&Math.abs(t.VRClockDiffToServer-(e.dtend-t.dtserver))>t.dtend-t.dtstart&&(console.log("VRClockDiffToServer updated",t.bedname,t.VRClockDiffToServer,e.dt-t.dtserver),t.VRClockDiffToServer=e.dtend-t.dtserver),t.dtcase=e.dtcase||0,t.ptcon=parseInt(e.ptcon)||0,t.pushData(e)})}wm_single_bedid?(e=wm_rooms[wm_single_bedid]).dtlast<e.dtplayer&&request_room_data():was_first&&(was_first=!1,request_room_data())}}),bedSocket.on("res_cmd",function(e){switch((e=JSON.parse(e)).job){case"update_vr":$("#wm-rooms").find("a.cmd-"+e.vrcode).removeClass("disabled"),$("#update-stat-"+e.vrcode).html("");break;case"del_bed":$("#"+e.bedid).remove(),$("."+e.bedid).remove(),$(".viewer-"+e.bedid).remove();break;case"del_beds":edit_vrs(curr_order),selected_beds2.clear(),toggle_btns();break;case"del_vr":$("#"+e.vrcode).remove();break;case"restart_vr":case"reboot_vr":$("#wm-rooms").find("a.cmd-"+e.vrcode).removeClass("disabled"),$("#update-stat-"+e.vrcode).html("")}}),bedSocket.on("recv_vr_ipaddr",function(e,t){var i=wm_rooms[e];console.log(i.bedname,t),i.vr_ipaddr=t,rewrite_room_title(e,i.vrver,t)}),window.setInterval(join_rooms.bind(null),1e3)}catch(e){console.log(e)}bedSocket.emit("req_json"),request_room_data(),check_status(),setInterval(check_status,5e3),window.setInterval(request_room_data,2e3)}wm_isMobile&&($("#tabs").css("font-size","13px"),$("#tabs").css("padding-left",".7rem"),$(".nav-link").css("padding",".5rem .7rem"),$("#edit-group-btn").remove(),$("#show-inactive-btn").remove(),$("#left-btn-group").remove(),$("#btn-user-list").remove(),$("#add-vr-btn").remove(),$("#plus-vr-btn").remove(),$("#wm-refresh").remove(),$(".wm-layout").addClass("mb-2"),$(".wm-time").css("margin","0"),$(".wm-timeX").css("margin","0"),$(".wm-room").css("-webkit-touch-callout","none").css("-webkit-user-select","none").css("-khtml-user-select","none").css("-moz-user-select","none").css("-ms-user-select","none").css("user-select","none"));var p,g=$(".page-footer")[0];g&&($(".page-footer").fadeIn(),p=function(){$(".page-footer").fadeOut()},g.onclick=p,document.addEventListener("scroll",p),setTimeout(p,5e3))}),isIE()&&(document.getElementsByTagName("footer")[0].style.display="none");